/* ---------------------------------------- Code exported from SAS Enterprise Guide DATE: jueves, 28 de febrero de 2019 TIME: 10:41:05 PROJECT: Proyecto_corep_BS_mas_TSB_3281_v2 PROJECT PATH: C:\Users\miquel.mirat\Desktop\testing\proyectos_input\Proyecto_corep_BS_mas_TSB_3281_v2.egp ---------------------------------------- */ /* START OF NODE: TSB de COREP a Columna SAS */ PROC SQL ; CREATE TABLE tipos_cambio as select *, '3281' AS CAT from oraggcom.canvi_oficial AS AUXILIAR where data_cre='31dec2018:0:0:0'dt and DIVISA='GBP' ORDER BY CAT; quit ; PROC SORT DATA=bsco_4.PLANTILLA_3281 OUT=TEST_3281 (KEEP=TEMPLATE@DATA_EXTRA@ROW@C:) ; BY TEMPLATE DATA_EXTRA ROW ; RUN ; PROC SQL ; CREATE TABLE WORK.TEST2_3281 AS SELECT *, C010*C110*100 AS C_PDxEAD, C230*(C110-C140)*100 AS C_LGDxEAD, C240*C140*100 AS C_LGDEFxEAD, C250*C110 AS C_MxEAD /*C110-C140 AS C_EAD_NO_EF*/ FROM WORK.TEST_3281 AS AUXILIAR */; QUIT ; PROC TRANSPOSE DATA=TEST2_3281 OUT=TEST3_3281 (RENAME=(_NAME_=COL)) ; BY TEMPLATE DATA_EXTRA ROW ; VAR C: ; RUN ; PROC SQL ; CREATE TABLE WORK.CAMBIO_MILES AS SELECT AUXILIAR.template, AUXILIAR.data_extra, AUXILIAR.row, AUXILIAR.COL, AUXILIAR.COL1 AS IMPORTE, AUXILIAR2.CANV_FIT*1000 AS TIPO_CAMBIO FROM WORK.TEST3_3281 AS AUXILIAR LEFT JOIN WORK.TIPOS_CAMBIO AUXILIAR2 ON (AUXILIAR.template=AUXILIAR2.CAT) ; QUIT ; PROC SQL ; CREATE TABLE WORK.CAMBIO_3281 AS SELECT AUXILIAR.template, AUXILIAR.data_extra, AUXILIAR.row, AUXILIAR.COL, AUXILIAR.IMPORTE, (case when COL IN ('C010','C230','C240','C250','C300') then IMPORTE else IMPORTE/TIPO_CAMBIO end) AS IMPORTE_mEUR FROM WORK.CAMBIO_MILES AS AUXILIAR WHERE AUXILIAR.IMPORTE NOT=0 ; QUIT ; /* Ponemos los mismos nombres que en la tabla de BS */ PROC SQL ; CREATE TABLE TABLA_3281_TSB AS SELECT t1.template AS COREP, t1.data_extra AS CATEGO, t1.ROW, t1.COL, t1.IMPORTE_mEUR AS IMPORTE FROM WORK.CAMBIO_3281 t1 ; QUIT ; PROC SQL ; CREATE TABLE TABLA_3281_VUELTA_TSB AS SELECT t1.COREP AS template, t1.CATEGO AS data_extra, t1.ROW, t1.COL, t1.IMPORTE AS COL1 FROM WORK.TABLA_3281_TSB t1 ; QUIT ; PROC SORT DATA=TABLA_3281_VUELTA_TSB OUT=TEST1_TABLA3281_VUELTA_TSB (KEEP=TEMPLATE@DATA_EXTRA@ROW@C:) ; BY TEMPLATE DATA_EXTRA ROW ; RUN ; 